{% extends 'base_admin.html' %}

{% block content %}
<div class="container">

    <h2>Ajouter une absence</h2>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary">Enregistrer</button>
        <a href="{% url 'liste_absences' %}" class="btn btn-secondary">Annuler</a>
    </form>
</div>

<script>
// Mise Ã  jour dynamique des emplois du temps
document.getElementById('id_eleve').addEventListener('change', function() {
    const eleveId = this.value;
    fetch(`/get_emplois/?eleve_id=${eleveId}`)
        .then(response => response.json())
        .then(data => {
            const select = document.getElementById('id_emploi_du_temps');
            select.innerHTML = '';
            data.forEach(emploi => {
                const option = document.createElement('option');
                option.value = emploi.id;
                option.textContent = `${emploi.date} - ${emploi.matiere}`;
                select.appendChild(option);
            });
        });
});


{% if messages %}
    {% for message in messages %}
        showToast('{{ message }}', 'success');
    {% endfor %}
{% endif %}

function showToast(message, type) {
    const toast = document.createElement('div');
    toast.className = `fixed top-20 right-4 p-4 rounded-lg ${type === 'error' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}
</script>
</script>
{% endblock %}